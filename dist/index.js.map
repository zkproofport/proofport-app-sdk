{"version":3,"file":"index.js","sources":["../src/constants.ts","../src/deeplink.ts","../src/qrcode.ts","../src/verifier.ts","../src/ProofPortSDK.ts"],"sourcesContent":["/**\n * ZKProofPort SDK Constants\n */\n\nimport type { CircuitType } from './types';\n\n/**\n * Default deep link scheme\n */\nexport const DEFAULT_SCHEME = 'zkproofport';\n\n/**\n * Deep link hosts\n */\nexport const DEEP_LINK_HOSTS = {\n  PROOF_REQUEST: 'proof-request',\n  PROOF_RESPONSE: 'proof-response',\n} as const;\n\n/**\n * Circuit metadata\n */\nexport const CIRCUIT_METADATA: Record<CircuitType, {\n  name: string;\n  description: string;\n  publicInputsCount: number;\n  publicInputNames: string[];\n}> = {\n  coinbase_attestation: {\n    name: 'Coinbase KYC',\n    description: 'Prove Coinbase identity verification',\n    publicInputsCount: 2,\n    publicInputNames: ['signal_hash', 'signer_list_merkle_root'],\n  },\n  coinbase_country_attestation: {\n    name: 'Coinbase Country',\n    description: 'Prove Coinbase country verification',\n    publicInputsCount: 14,\n    publicInputNames: ['signal_hash', 'signer_list_merkle_root', 'country_list', 'country_list_length', 'is_included'],\n  },\n};\n\n/**\n * Standard verifier contract ABI (shared across all circuits)\n */\nexport const VERIFIER_ABI = [\n  'function verify(bytes calldata _proof, bytes32[] calldata _publicInputs) external view returns (bool)',\n];\n\n/**\n * RPC endpoints by chain ID\n */\nexport const RPC_ENDPOINTS: Record<number, string> = {\n  84532: 'https://sepolia.base.org', // Base Sepolia\n  8453: 'https://mainnet.base.org', // Base Mainnet\n};\n\n/**\n * Request expiry time (default: 10 minutes)\n */\nexport const DEFAULT_REQUEST_EXPIRY_MS = 10 * 60 * 1000;\n\n/**\n * Maximum QR code data size (bytes)\n */\nexport const MAX_QR_DATA_SIZE = 2953; // Version 40 with L error correction\n\nexport const COINBASE_ATTESTATION_PUBLIC_INPUT_LAYOUT = {\n  SIGNAL_HASH_START: 0,\n  SIGNAL_HASH_END: 31,\n  MERKLE_ROOT_START: 32,\n  MERKLE_ROOT_END: 63,\n  SCOPE_START: 64,\n  SCOPE_END: 95,\n  NULLIFIER_START: 96,\n  NULLIFIER_END: 127,\n} as const;\n\nexport const COINBASE_COUNTRY_PUBLIC_INPUT_LAYOUT = {\n  SIGNAL_HASH_START: 0,\n  SIGNAL_HASH_END: 31,\n  MERKLE_ROOT_START: 32,\n  MERKLE_ROOT_END: 63,\n  COUNTRY_LIST_START: 64,\n  COUNTRY_LIST_END: 83,\n  COUNTRY_LIST_LENGTH: 84,\n  IS_INCLUDED: 85,\n  SCOPE_START: 86,\n  SCOPE_END: 117,\n  NULLIFIER_START: 118,\n  NULLIFIER_END: 149,\n} as const;\n\nexport const NULLIFIER_REGISTRY_ABI = [\n  'function registerCircuit(bytes32 _circuitId, address _verifier, uint256 _scopeIndex, uint256 _nullifierIndex) external',\n  'function updateCircuit(bytes32 _circuitId, address _newVerifier, uint256 _scopeIndex, uint256 _nullifierIndex) external',\n  'function verifyAndRegister(bytes32 _circuitId, bytes calldata _proof, bytes32[] calldata _publicInputs) external returns (bool)',\n  'function isNullifierUsed(bytes32 _nullifier) external view returns (bool)',\n  'function getScope(bytes32 _nullifier) external view returns (bytes32)',\n  'function getCircuit(bytes32 _nullifier) external view returns (bytes32)',\n  'function verifyOnly(bytes32 _circuitId, bytes calldata _proof, bytes32[] calldata _publicInputs) external view returns (bool)',\n  'event CircuitRegistered(bytes32 indexed circuitId, address verifier)',\n  'event CircuitUpdated(bytes32 indexed circuitId, address newVerifier)',\n  'event NullifierRegistered(bytes32 indexed nullifier, bytes32 indexed scope, bytes32 indexed circuitId)',\n];\n","/**\n * Deep Link utilities for ZKProofPort SDK\n */\n\nimport type {\n  ProofRequest,\n  ProofResponse,\n  CircuitInputs,\n  CoinbaseKycInputs,\n  CoinbaseCountryInputs,\n  DeepLinkComponents,\n  CircuitType,\n} from './types';\nimport { DEFAULT_SCHEME, DEEP_LINK_HOSTS } from './constants';\n\n/**\n * Generate a unique request ID\n */\nexport function generateRequestId(): string {\n  const timestamp = Date.now().toString(36);\n  const random = Math.random().toString(36).substring(2, 10);\n  return `req-${timestamp}-${random}`;\n}\n\n/**\n * Encode data for URL transmission (base64url with UTF-8 support)\n */\nexport function encodeData(data: object): string {\n  const json = JSON.stringify(data);\n  // Use base64url encoding (URL-safe) with UTF-8 support\n  if (typeof btoa === 'function') {\n    // Browser: UTF-8 encode first, then base64\n    const utf8Encoded = encodeURIComponent(json).replace(/%([0-9A-F]{2})/g, (_, p1) =>\n      String.fromCharCode(parseInt(p1, 16))\n    );\n    return btoa(utf8Encoded)\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_')\n      .replace(/=+$/, '');\n  }\n  // Node.js environment\n  return Buffer.from(json, 'utf-8')\n    .toString('base64')\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=+$/, '');\n}\n\n/**\n * Decode URL-transmitted data (base64url with UTF-8 support)\n */\nexport function decodeData<T>(encoded: string): T {\n  // Restore base64 padding\n  let base64 = encoded.replace(/-/g, '+').replace(/_/g, '/');\n  while (base64.length % 4) {\n    base64 += '=';\n  }\n\n  let json: string;\n  if (typeof atob === 'function') {\n    // Browser: decode base64, then UTF-8 decode\n    const decoded = atob(base64);\n    json = decodeURIComponent(\n      decoded.split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join('')\n    );\n  } else {\n    json = Buffer.from(base64, 'base64').toString('utf-8');\n  }\n\n  return JSON.parse(json) as T;\n}\n\n/**\n * Build a proof request deep link URL\n */\nexport function buildProofRequestUrl(\n  request: ProofRequest,\n  scheme: string = DEFAULT_SCHEME\n): string {\n  const encodedRequest = encodeData(request);\n  return `${scheme}://${DEEP_LINK_HOSTS.PROOF_REQUEST}?data=${encodedRequest}`;\n}\n\n/**\n * Build a callback URL with proof response\n */\nexport function buildCallbackUrl(\n  callbackUrl: string,\n  response: ProofResponse\n): string {\n  const url = new URL(callbackUrl);\n  url.searchParams.set('requestId', response.requestId);\n  url.searchParams.set('status', response.status);\n\n  if (response.status === 'completed' && response.proof) {\n    url.searchParams.set('proof', response.proof);\n    if (response.publicInputs) {\n      url.searchParams.set('publicInputs', response.publicInputs.join(','));\n    }\n    if (response.numPublicInputs !== undefined) {\n      url.searchParams.set('numPublicInputs', response.numPublicInputs.toString());\n    }\n    if (response.timestamp) {\n      url.searchParams.set('timestamp', response.timestamp.toString());\n    }\n    if (response.nullifier) {\n      url.searchParams.set('nullifier', response.nullifier);\n    }\n  } else if (response.status === 'error' && response.error) {\n    url.searchParams.set('error', response.error);\n  }\n\n  return url.toString();\n}\n\n/**\n * Parse a proof request from deep link URL\n */\nexport function parseProofRequestUrl(url: string): ProofRequest | null {\n  try {\n    const urlObj = new URL(url);\n    const data = urlObj.searchParams.get('data');\n\n    if (!data) {\n      return null;\n    }\n\n    return decodeData<ProofRequest>(data);\n  } catch (error) {\n    console.error('Failed to parse proof request URL:', error);\n    return null;\n  }\n}\n\n/**\n * Parse a proof response from callback URL\n */\nexport function parseProofResponseUrl(url: string): ProofResponse | null {\n  try {\n    const urlObj = new URL(url);\n    const requestId = urlObj.searchParams.get('requestId');\n    const status = urlObj.searchParams.get('status') as ProofResponse['status'];\n\n    if (!requestId || !status) {\n      return null;\n    }\n\n    const response: ProofResponse = {\n      requestId,\n      circuit: urlObj.searchParams.get('circuit') as CircuitType || 'coinbase_attestation',\n      status,\n    };\n\n    if (status === 'completed') {\n      response.proof = urlObj.searchParams.get('proof') || undefined;\n      const publicInputsStr = urlObj.searchParams.get('publicInputs');\n      if (publicInputsStr) {\n        response.publicInputs = publicInputsStr.split(',');\n      }\n      const numPublicInputs = urlObj.searchParams.get('numPublicInputs');\n      if (numPublicInputs) {\n        response.numPublicInputs = parseInt(numPublicInputs, 10);\n      }\n      const timestamp = urlObj.searchParams.get('timestamp');\n      if (timestamp) {\n        response.timestamp = parseInt(timestamp, 10);\n      }\n      response.nullifier = urlObj.searchParams.get('nullifier') || undefined;\n    } else if (status === 'error') {\n      response.error = urlObj.searchParams.get('error') || undefined;\n    }\n\n    return response;\n  } catch (error) {\n    console.error('Failed to parse proof response URL:', error);\n    return null;\n  }\n}\n\n/**\n * Parse deep link URL into components\n */\nexport function parseDeepLink(url: string): DeepLinkComponents | null {\n  try {\n    // Handle custom scheme URLs\n    const schemeMatch = url.match(/^([a-z][a-z0-9+.-]*):\\/\\/(.+)$/i);\n    if (!schemeMatch) {\n      return null;\n    }\n\n    const scheme = schemeMatch[1];\n    const rest = schemeMatch[2];\n\n    // Parse host and path\n    const [hostPath, queryString] = rest.split('?');\n    const [host, ...pathParts] = hostPath.split('/');\n    const path = '/' + pathParts.join('/');\n\n    // Parse query parameters\n    const params: Record<string, string> = {};\n    if (queryString) {\n      const searchParams = new URLSearchParams(queryString);\n      searchParams.forEach((value, key) => {\n        params[key] = value;\n      });\n    }\n\n    return { scheme, host, path, params };\n  } catch (error) {\n    console.error('Failed to parse deep link:', error);\n    return null;\n  }\n}\n\n/**\n * Check if URL is a ZKProofPort deep link\n */\nexport function isProofPortDeepLink(\n  url: string,\n  scheme: string = DEFAULT_SCHEME\n): boolean {\n  return url.toLowerCase().startsWith(`${scheme.toLowerCase()}://`);\n}\n\n/**\n * Validate proof request\n */\nexport function validateProofRequest(request: ProofRequest): { valid: boolean; error?: string } {\n  if (!request.requestId) {\n    return { valid: false, error: 'Missing requestId' };\n  }\n\n  if (!request.circuit) {\n    return { valid: false, error: 'Missing circuit type' };\n  }\n\n  if (!['coinbase_attestation', 'coinbase_country_attestation'].includes(request.circuit)) {\n    return { valid: false, error: `Invalid circuit type: ${request.circuit}` };\n  }\n\n  if (!request.callbackUrl) {\n    return { valid: false, error: 'Missing callbackUrl' };\n  }\n\n  // Validate circuit-specific inputs\n  if (request.circuit === 'coinbase_attestation') {\n    // Coinbase KYC: userAddress is optional - app will connect wallet if not provided\n    const inputs = request.inputs as CoinbaseKycInputs;\n    if (inputs.userAddress && !/^0x[a-fA-F0-9]{40}$/.test(inputs.userAddress)) {\n      return { valid: false, error: 'Invalid userAddress format' };\n    }\n    // If userAddress is not provided, app will prompt wallet connection - this is valid\n  } else if (request.circuit === 'coinbase_country_attestation') {\n    const inputs = request.inputs as CoinbaseCountryInputs;\n    if (inputs.userAddress && !/^0x[a-fA-F0-9]{40}$/.test(inputs.userAddress)) {\n      return { valid: false, error: 'Invalid userAddress format' };\n    }\n    if (inputs.countryList && !Array.isArray(inputs.countryList)) {\n      return { valid: false, error: 'countryList must be an array of strings' };\n    }\n    if (inputs.countryList && !inputs.countryList.every(c => typeof c === 'string')) {\n      return { valid: false, error: 'countryList must contain only strings' };\n    }\n  }\n\n  // Check expiry\n  if (request.expiresAt && Date.now() > request.expiresAt) {\n    return { valid: false, error: 'Request has expired' };\n  }\n\n  return { valid: true };\n}\n","/**\n * QR Code utilities for ZKProofPort SDK\n */\n\nimport QRCode from 'qrcode';\nimport type { ProofRequest, QRCodeOptions } from './types';\nimport { buildProofRequestUrl } from './deeplink';\nimport { DEFAULT_SCHEME, MAX_QR_DATA_SIZE } from './constants';\n\n/**\n * Default QR code options\n */\nconst DEFAULT_QR_OPTIONS: QRCodeOptions = {\n  width: 300,\n  errorCorrectionLevel: 'M',\n  margin: 2,\n  darkColor: '#000000',\n  lightColor: '#ffffff',\n};\n\n/**\n * Generate QR code as data URL (base64 PNG)\n */\nexport async function generateQRCodeDataUrl(\n  request: ProofRequest,\n  options: QRCodeOptions = {},\n  scheme: string = DEFAULT_SCHEME\n): Promise<string> {\n  const url = buildProofRequestUrl(request, scheme);\n\n  // Check data size\n  if (url.length > MAX_QR_DATA_SIZE) {\n    throw new Error(\n      `QR code data too large (${url.length} bytes). Maximum is ${MAX_QR_DATA_SIZE} bytes.`\n    );\n  }\n\n  const mergedOptions = { ...DEFAULT_QR_OPTIONS, ...options };\n\n  return QRCode.toDataURL(url, {\n    width: mergedOptions.width,\n    errorCorrectionLevel: mergedOptions.errorCorrectionLevel,\n    margin: mergedOptions.margin,\n    color: {\n      dark: mergedOptions.darkColor,\n      light: mergedOptions.lightColor,\n    },\n  });\n}\n\n/**\n * Generate QR code as SVG string\n */\nexport async function generateQRCodeSVG(\n  request: ProofRequest,\n  options: QRCodeOptions = {},\n  scheme: string = DEFAULT_SCHEME\n): Promise<string> {\n  const url = buildProofRequestUrl(request, scheme);\n\n  if (url.length > MAX_QR_DATA_SIZE) {\n    throw new Error(\n      `QR code data too large (${url.length} bytes). Maximum is ${MAX_QR_DATA_SIZE} bytes.`\n    );\n  }\n\n  const mergedOptions = { ...DEFAULT_QR_OPTIONS, ...options };\n\n  return QRCode.toString(url, {\n    type: 'svg',\n    width: mergedOptions.width,\n    errorCorrectionLevel: mergedOptions.errorCorrectionLevel,\n    margin: mergedOptions.margin,\n    color: {\n      dark: mergedOptions.darkColor,\n      light: mergedOptions.lightColor,\n    },\n  });\n}\n\n/**\n * Generate QR code to canvas element (browser only)\n */\nexport async function generateQRCodeToCanvas(\n  canvas: HTMLCanvasElement,\n  request: ProofRequest,\n  options: QRCodeOptions = {},\n  scheme: string = DEFAULT_SCHEME\n): Promise<void> {\n  const url = buildProofRequestUrl(request, scheme);\n\n  if (url.length > MAX_QR_DATA_SIZE) {\n    throw new Error(\n      `QR code data too large (${url.length} bytes). Maximum is ${MAX_QR_DATA_SIZE} bytes.`\n    );\n  }\n\n  const mergedOptions = { ...DEFAULT_QR_OPTIONS, ...options };\n\n  await QRCode.toCanvas(canvas, url, {\n    width: mergedOptions.width,\n    errorCorrectionLevel: mergedOptions.errorCorrectionLevel,\n    margin: mergedOptions.margin,\n    color: {\n      dark: mergedOptions.darkColor,\n      light: mergedOptions.lightColor,\n    },\n  });\n}\n\n/**\n * Estimate QR code data size for a request\n */\nexport function estimateQRDataSize(\n  request: ProofRequest,\n  scheme: string = DEFAULT_SCHEME\n): { size: number; withinLimit: boolean } {\n  const url = buildProofRequestUrl(request, scheme);\n  return {\n    size: url.length,\n    withinLimit: url.length <= MAX_QR_DATA_SIZE,\n  };\n}\n","/**\n * On-chain verification utilities for ZKProofPort SDK\n *\n * Compatible with both ethers v5 and v6.\n */\n\nimport { ethers } from 'ethers';\nimport type { CircuitType, ParsedProof, VerifierContract } from './types';\nimport { VERIFIER_ABI, RPC_ENDPOINTS } from './constants';\n\n// ethers v5/v6 compatibility shims\nconst _ethers = ethers as any;\n\nfunction hexZeroPad(value: string, length: number): string {\n  // v6: ethers.zeroPadValue, v5: ethers.utils.hexZeroPad\n  if (typeof _ethers.zeroPadValue === 'function') return _ethers.zeroPadValue(value, length);\n  if (_ethers.utils?.hexZeroPad) return _ethers.utils.hexZeroPad(value, length);\n  // manual fallback\n  const hex = value.startsWith('0x') ? value.slice(2) : value;\n  return '0x' + hex.padStart(length * 2, '0');\n}\n\nfunction createJsonRpcProvider(url: string) {\n  // v6: ethers.JsonRpcProvider, v5: ethers.providers.JsonRpcProvider\n  if (typeof _ethers.JsonRpcProvider === 'function') return new _ethers.JsonRpcProvider(url);\n  if (_ethers.providers?.JsonRpcProvider) return new _ethers.providers.JsonRpcProvider(url);\n  throw new Error('No JsonRpcProvider found in ethers');\n}\n\n/**\n * Resolve verifier from SDK config or proof response.\n * SDK config (customVerifier) takes priority over response-provided verifier.\n */\nfunction resolveVerifier(\n  customVerifier?: VerifierContract,\n  responseVerifier?: { verifierAddress?: string; chainId?: number }\n): VerifierContract | null {\n  if (customVerifier) return customVerifier;\n  if (responseVerifier?.verifierAddress) {\n    return {\n      address: responseVerifier.verifierAddress,\n      chainId: responseVerifier.chainId ?? 0,\n      abi: VERIFIER_ABI,\n    };\n  }\n  return null;\n}\n\n/**\n * Get verifier contract instance\n */\nexport function getVerifierContract(\n  providerOrSigner: any,\n  verifier: VerifierContract\n): ethers.Contract {\n  return new ethers.Contract(\n    verifier.address,\n    verifier.abi,\n    providerOrSigner\n  );\n}\n\n/**\n * Get default provider for a chain\n */\nexport function getDefaultProvider(chainId: number) {\n  const rpcUrl = RPC_ENDPOINTS[chainId];\n  if (!rpcUrl) {\n    throw new Error(`No RPC endpoint configured for chain ${chainId}`);\n  }\n  return createJsonRpcProvider(rpcUrl);\n}\n\n/**\n * Verify proof on-chain\n */\nexport async function verifyProofOnChain(\n  circuit: CircuitType,\n  parsedProof: ParsedProof,\n  providerOrSigner?: any,\n  customVerifier?: VerifierContract,\n  responseVerifier?: { verifierAddress?: string; chainId?: number }\n): Promise<{ valid: boolean; error?: string }> {\n  const verifier = resolveVerifier(customVerifier, responseVerifier);\n  if (!verifier) {\n    return {\n      valid: false,\n      error: 'No verifier address provided. Configure via SDK or ensure proof response includes verifierAddress.',\n    };\n  }\n\n  const provider = providerOrSigner || (verifier.chainId > 0 ? getDefaultProvider(verifier.chainId) : null);\n  if (!provider) {\n    return {\n      valid: false,\n      error: 'No provider available. Provide a provider or ensure chainId is set for RPC lookup.',\n    };\n  }\n\n  const contract = getVerifierContract(provider, verifier);\n\n  try {\n    const isValid = await contract.verify(\n      parsedProof.proofHex,\n      parsedProof.publicInputsHex\n    );\n\n    return { valid: isValid };\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    return { valid: false, error: errorMessage };\n  }\n}\n\n/**\n * Ensure a hex string has the 0x prefix\n */\nfunction ensureHexPrefix(hex: string): string {\n  return hex.startsWith('0x') ? hex : `0x${hex}`;\n}\n\n/**\n * Parse proof response into format suitable for on-chain verification.\n * Public inputs are zero-padded to 32 bytes (bytes32).\n */\nexport function parseProofForOnChain(\n  proof: string,\n  publicInputs: string[],\n  numPublicInputs: number\n): ParsedProof {\n  const proofHex = ensureHexPrefix(proof);\n\n  const publicInputsHex = publicInputs.map((input) => {\n    return hexZeroPad(ensureHexPrefix(input), 32);\n  });\n\n  return {\n    proofHex,\n    publicInputsHex,\n    numPublicInputs,\n  };\n}\n\n/**\n * Require a verifier or throw with a helpful message\n */\nfunction requireVerifier(circuit: CircuitType, verifier?: VerifierContract): VerifierContract {\n  if (!verifier) {\n    throw new Error(`No verifier configured for circuit '${circuit}'. Configure via SDK verifiers option.`);\n  }\n  return verifier;\n}\n\n/**\n * Get verifier contract address for a circuit\n */\nexport function getVerifierAddress(\n  circuit: CircuitType,\n  customVerifier?: VerifierContract\n): string {\n  return requireVerifier(circuit, customVerifier).address;\n}\n\n/**\n * Get chain ID for a circuit's verifier\n */\nexport function getVerifierChainId(\n  circuit: CircuitType,\n  customVerifier?: VerifierContract\n): number {\n  return requireVerifier(circuit, customVerifier).chainId;\n}\n\nexport function extractScopeFromPublicInputs(\n  publicInputsHex: string[],\n  circuit?: string,\n): string | null {\n  let start: number, end: number;\n  if (circuit === 'coinbase_country_attestation') {\n    start = 86; end = 117;\n  } else {\n    start = 64; end = 95;\n  }\n  if (publicInputsHex.length <= end) return null;\n  const scopeFields = publicInputsHex.slice(start, end + 1);\n  return reconstructBytes32FromFields(scopeFields);\n}\n\nexport function extractNullifierFromPublicInputs(\n  publicInputsHex: string[],\n  circuit?: string,\n): string | null {\n  let start: number, end: number;\n  if (circuit === 'coinbase_country_attestation') {\n    start = 118; end = 149;\n  } else {\n    start = 96; end = 127;\n  }\n  if (publicInputsHex.length <= end) return null;\n  const nullifierFields = publicInputsHex.slice(start, end + 1);\n  return reconstructBytes32FromFields(nullifierFields);\n}\n\nfunction reconstructBytes32FromFields(fields: string[]): string {\n  if (fields.length !== 32) {\n    throw new Error(`Expected 32 fields, got ${fields.length}`);\n  }\n  const bytes = fields.map(f => {\n    const byte = BigInt(f) & 0xFFn;\n    return byte.toString(16).padStart(2, '0');\n  }).join('');\n  return '0x' + bytes;\n}\n","/**\n * ProofPort SDK - Main class\n */\n\nimport type {\n  ProofRequest,\n  ProofResponse,\n  CircuitType,\n  CircuitInputs,\n  CoinbaseKycInputs,\n  CoinbaseCountryInputs,\n  ProofPortConfig,\n  QRCodeOptions,\n  ParsedProof,\n  VerifierContract,\n} from './types';\nimport {\n  generateRequestId,\n  buildProofRequestUrl,\n  buildCallbackUrl,\n  parseProofRequestUrl,\n  parseProofResponseUrl,\n  validateProofRequest,\n  isProofPortDeepLink,\n} from './deeplink';\nimport {\n  generateQRCodeDataUrl,\n  generateQRCodeSVG,\n  generateQRCodeToCanvas,\n  estimateQRDataSize,\n} from './qrcode';\nimport {\n  verifyProofOnChain,\n  parseProofForOnChain,\n  getVerifierAddress,\n  getVerifierChainId,\n} from './verifier';\nimport {\n  DEFAULT_SCHEME,\n  DEFAULT_REQUEST_EXPIRY_MS,\n  CIRCUIT_METADATA,\n} from './constants';\n\n\n/**\n * ZKProofPort SDK for requesting and verifying ZK proofs\n */\nexport class ProofPortSDK {\n  private config: Required<ProofPortConfig>;\n  private pendingRequests: Map<string, ProofRequest> = new Map();\n\n  constructor(config: ProofPortConfig = {}) {\n    this.config = {\n      scheme: config.scheme || DEFAULT_SCHEME,\n      defaultCallbackUrl: config.defaultCallbackUrl || '',\n      verifiers: config.verifiers || {},\n    };\n  }\n\n  // ============ Request Creation ============\n\n  /**\n   * Create a Coinbase KYC verification request\n   */\n  createCoinbaseKycRequest(\n    inputs: CoinbaseKycInputs,\n    options: {\n      callbackUrl?: string;\n      message?: string;\n      dappName?: string;\n      dappIcon?: string;\n      expiresInMs?: number;\n    } = {}\n  ): ProofRequest {\n    if (!inputs.scope) {\n      throw new Error('scope is required for coinbase_attestation circuit');\n    }\n\n    const request: ProofRequest = {\n      requestId: generateRequestId(),\n      circuit: 'coinbase_attestation',\n      inputs,\n      callbackUrl: options.callbackUrl || this.config.defaultCallbackUrl,\n      message: options.message,\n      dappName: options.dappName,\n      dappIcon: options.dappIcon,\n      createdAt: Date.now(),\n      expiresAt: Date.now() + (options.expiresInMs || DEFAULT_REQUEST_EXPIRY_MS),\n    };\n\n    this.pendingRequests.set(request.requestId, request);\n    return request;\n  }\n\n  /**\n   * Create a Coinbase Country attestation request\n   */\n  createCoinbaseCountryRequest(\n    inputs: CoinbaseCountryInputs,\n    options: {\n      callbackUrl?: string;\n      message?: string;\n      dappName?: string;\n      dappIcon?: string;\n      expiresInMs?: number;\n    } = {}\n  ): ProofRequest {\n    if (!inputs.scope) {\n      throw new Error('scope is required for coinbase_country_attestation circuit');\n    }\n\n    const request: ProofRequest = {\n      requestId: generateRequestId(),\n      circuit: 'coinbase_country_attestation',\n      inputs,\n      callbackUrl: options.callbackUrl || this.config.defaultCallbackUrl,\n      message: options.message,\n      dappName: options.dappName,\n      dappIcon: options.dappIcon,\n      createdAt: Date.now(),\n      expiresAt: Date.now() + (options.expiresInMs || DEFAULT_REQUEST_EXPIRY_MS),\n    };\n\n    this.pendingRequests.set(request.requestId, request);\n    return request;\n  }\n\n  /**\n   * Create a generic proof request\n   */\n  createProofRequest(\n    circuit: CircuitType,\n    inputs: CircuitInputs,\n    options: {\n      callbackUrl?: string;\n      message?: string;\n      dappName?: string;\n      dappIcon?: string;\n      expiresInMs?: number;\n    } = {}\n  ): ProofRequest {\n    if (circuit === 'coinbase_country_attestation') {\n      return this.createCoinbaseCountryRequest(inputs as CoinbaseCountryInputs, options);\n    } else {\n      return this.createCoinbaseKycRequest(inputs as CoinbaseKycInputs, options);\n    }\n  }\n\n  // ============ Deep Link Generation ============\n\n  /**\n   * Generate deep link URL for a proof request\n   */\n  getDeepLinkUrl(request: ProofRequest): string {\n    return buildProofRequestUrl(request, this.config.scheme);\n  }\n\n  /**\n   * Open ZKProofPort app with a proof request (browser)\n   */\n  openProofRequest(request: ProofRequest): void {\n    const url = this.getDeepLinkUrl(request);\n    window.location.href = url;\n  }\n\n  /**\n   * Request a proof â€” auto-detects platform.\n   * Mobile: opens deep link directly.\n   * Desktop: returns QR code data URL and deep link URL for display.\n   */\n  async requestProof(\n    request: ProofRequest,\n    qrOptions?: QRCodeOptions\n  ): Promise<{ deepLink: string; qrDataUrl?: string; mobile: boolean }> {\n    const deepLink = this.getDeepLinkUrl(request);\n    const mobile = ProofPortSDK.isMobile();\n\n    if (mobile) {\n      window.location.href = deepLink;\n      return { deepLink, mobile: true };\n    }\n\n    const qrDataUrl = await this.generateQRCode(request, qrOptions);\n    return { deepLink, qrDataUrl, mobile: false };\n  }\n\n  // ============ QR Code Generation ============\n\n  /**\n   * Generate QR code as data URL\n   */\n  async generateQRCode(\n    request: ProofRequest,\n    options?: QRCodeOptions\n  ): Promise<string> {\n    return generateQRCodeDataUrl(request, options, this.config.scheme);\n  }\n\n  /**\n   * Generate QR code as SVG string\n   */\n  async generateQRCodeSVG(\n    request: ProofRequest,\n    options?: QRCodeOptions\n  ): Promise<string> {\n    return generateQRCodeSVG(request, options, this.config.scheme);\n  }\n\n  /**\n   * Render QR code to canvas element\n   */\n  async renderQRCodeToCanvas(\n    canvas: HTMLCanvasElement,\n    request: ProofRequest,\n    options?: QRCodeOptions\n  ): Promise<void> {\n    return generateQRCodeToCanvas(canvas, request, options, this.config.scheme);\n  }\n\n  /**\n   * Check if request data fits in QR code\n   */\n  checkQRCodeSize(request: ProofRequest): { size: number; withinLimit: boolean } {\n    return estimateQRDataSize(request, this.config.scheme);\n  }\n\n  // ============ Response Handling ============\n\n  /**\n   * Parse proof response from callback URL\n   */\n  parseResponse(url: string): ProofResponse | null {\n    return parseProofResponseUrl(url);\n  }\n\n  /**\n   * Check if a URL is a ZKProofPort response\n   */\n  isProofPortResponse(url: string): boolean {\n    try {\n      const urlObj = new URL(url);\n      return urlObj.searchParams.has('requestId') && urlObj.searchParams.has('status');\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Get pending request by ID\n   */\n  getPendingRequest(requestId: string): ProofRequest | undefined {\n    return this.pendingRequests.get(requestId);\n  }\n\n  /**\n   * Clear pending request\n   */\n  clearPendingRequest(requestId: string): void {\n    this.pendingRequests.delete(requestId);\n  }\n\n  // ============ Verification ============\n\n  /**\n   * Verify proof on-chain\n   */\n  async verifyOnChain(\n    circuit: CircuitType,\n    proof: string,\n    publicInputs: string[],\n    providerOrSigner?: any\n  ): Promise<{ valid: boolean; error?: string }> {\n    const parsedProof = parseProofForOnChain(\n      proof,\n      publicInputs,\n      publicInputs.length\n    );\n\n    const customVerifier = this.config.verifiers[circuit];\n    return verifyProofOnChain(circuit, parsedProof, providerOrSigner, customVerifier);\n  }\n\n  /**\n   * Verify proof from response on-chain\n   */\n  async verifyResponseOnChain(\n    response: ProofResponse,\n    providerOrSigner?: any\n  ): Promise<{ valid: boolean; error?: string }> {\n    if (response.status !== 'completed' || !response.proof || !response.publicInputs) {\n      return { valid: false, error: 'Invalid or incomplete response' };\n    }\n\n    const parsedProof = parseProofForOnChain(\n      response.proof,\n      response.publicInputs,\n      response.publicInputs.length\n    );\n\n    const customVerifier = this.config.verifiers[response.circuit];\n    const responseVerifier = {\n      verifierAddress: response.verifierAddress,\n      chainId: response.chainId,\n    };\n    return verifyProofOnChain(response.circuit, parsedProof, providerOrSigner, customVerifier, responseVerifier);\n  }\n\n  // ============ Utility Methods ============\n\n  /**\n   * Get verifier contract address\n   */\n  getVerifierAddress(circuit: CircuitType): string {\n    const customVerifier = this.config.verifiers[circuit];\n    return getVerifierAddress(circuit, customVerifier);\n  }\n\n  /**\n   * Get verifier chain ID\n   */\n  getVerifierChainId(circuit: CircuitType): number {\n    const customVerifier = this.config.verifiers[circuit];\n    return getVerifierChainId(circuit, customVerifier);\n  }\n\n  /**\n   * Get circuit metadata\n   */\n  getCircuitMetadata(circuit: CircuitType) {\n    return CIRCUIT_METADATA[circuit];\n  }\n\n  /**\n   * Get all supported circuits\n   */\n  getSupportedCircuits(): CircuitType[] {\n    return Object.keys(CIRCUIT_METADATA) as CircuitType[];\n  }\n\n  /**\n   * Validate a proof request\n   */\n  validateRequest(request: ProofRequest): { valid: boolean; error?: string } {\n    return validateProofRequest(request);\n  }\n\n  /**\n   * Check if URL is a ZKProofPort deep link\n   */\n  isProofPortDeepLink(url: string): boolean {\n    return isProofPortDeepLink(url, this.config.scheme);\n  }\n\n  /**\n   * Parse proof request from deep link URL\n   */\n  parseDeepLink(url: string): ProofRequest | null {\n    return parseProofRequestUrl(url);\n  }\n\n  // ============ Static Factory ============\n\n  /**\n   * Create SDK with default configuration\n   */\n  static create(config?: ProofPortConfig): ProofPortSDK {\n    return new ProofPortSDK(config);\n  }\n\n  /**\n   * Detect if running on a mobile device\n   */\n  static isMobile(): boolean {\n    if (typeof navigator === 'undefined') return false;\n    return /Android|iPhone|iPad|iPod|webOS|BlackBerry|IEMobile|Opera Mini/i.test(\n      navigator.userAgent\n    );\n  }\n}\n\nexport default ProofPortSDK;\n"],"names":["ethers"],"mappings":"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"}